<html>
<head>
<link rel="stylesheet" href="blueprint/screen.css" type="text/css" media="screen, projection">
<style type="text/css">
form input.wait_time { /*slim up the wide 999 second boxes */
	width: 3em;
}
label {
	font-weight: normal;
}
div.wait_updown {
	display: inline-block;
	position: relative;
	top: 8px;
}
div.wait_updown a {
	display: block;
	border: 1px solid #aaa;
	background: rgb(247,247,247);
	font-size: 1em;
	text-align: center;
	text-decoration: none;
	color: #000;
	width: 15px;
	height: 16px;
	margin: 0 0 -1px 0;
}
</style>
<!--[if lt IE 8]>
	<link rel="stylesheet" href="blueprint/ie.css" type="text/css" media="screen, projection">
<![endif]-->
<script src="jquery-1.7.1.min.js"></script>

<script>
	$(function(){//shortcut for doc.ready		
				
		$("input.wait_time").change(function(){			//whenever the visible field changes
			var newval = three_digits($(this).val());		//sanitize the input box
			$(this).siblings("input:hidden").val(newval);	//update the hidden field with sanitized and padded data
			$(this).val(parseInt(newval));					//update the input box with sanitized UNpadded data
		});

		
		function three_digits(num) {
			if(parseInt(num) >= 0){		//sanitize, filter out NaN and negative numbers
				//console.log(parseInt(num));
			    var num = "000" + num;
			    return num.substr(num.length - 3);
			}else{
				//alert("Dude, \"" + num + "\" is not positive integer.")
				console.log("ERROR: num = " + num + "  	parseInt(num) = " + parseInt(num));
				return "000";			//if the user entered garbage, set to "000"
			};
		};//three_digits()
		
		
		//$("#save").click(cupcake);
		$("#save").click(function(){
			dummy_data = "1,2,3,4,5,6;0,1,0,1,0,1;0,1,10,100,500,900;1,2,3,4,5,6;0,1,0,1,0,1;0,1,10,100,500,900;"
			//dummy_data = "1,2,3,4,5,6;"
			console.log(dummy_data);
			$.post("http://192.168.1.9/testget",dummy_data,function(){
				
			});
		});
		
		function cupcake(){
			var post_data = "";					//initialize the POST string
			var counter = 0;					//use to insert commas after each row
			var rows = $(".row").length;		//count how many rows, use for delimiters
			var column_names = ["select.sensor", "select.sensor_state", "input.wait_time", "select.output", "select.output_state", ".output_duration"];
			
			for (var i=0, tot=column_names.length; i < tot; i++) {
			    //console.log(column_names[i]);
				$(column_names[i]).each(function(){	//loop through a single column
					counter ++;						//increment counter
					post_data += $(this).val();		//append value of input
					if(counter == rows){			//append appropriate element or row delimiter
						post_data += ";";			//row delimiter
						counter = 0;				//reset counter
					}else{
						post_data += ",";			//element delimiter
					};
				});//each sensor loop
			};//loop through each column
			
			//console.log("rows: " + rows);
			console.log(post_data);				//log to firebug
			
			$.post("http://192.168.1.9/testget",post_data,function(){ 	//the AJAX bit
			//	console.log("posted " + post_data);
			});
		};//end cupcake()
		
		$(".wait_updown .up").click(function(){
			current_wait = parseInt($(this).parent().next().val());		//get current wait
			$(this).parent().next().val(current_wait + 5);				//add x seconds to wait
			return false;			//prevent the html link from doing anything
		})//end up click
		
		$(".wait_updown .down").click(function(){
			current_wait = parseInt($(this).parent().next().val());
			$(this).parent().next().val(current_wait - 5);
			return false;			//prevent the html link from doing anything
		})//end down click
		
		//Update the form with data
		// IE from the Arduino via AJAX
		/*
		$("#form #first").children().each(function(){
			data = "5";						//this is just a test
			if($(this).val() == data) {
				$(this).prop("selected","selected");
			};
		});
		*/
	});//doc.ready
</script>
</head>

<body>
	<div class="container">
		<div class="prepend-1 span-18">
			<h1>The HB</h1>
			<a href="settings.html">Settings</a> | <a href="index.html">Program</a> | <a href="live.html">Live View</a>
  			<h2>Program</h2>
			<p>Some kind of description here.</p>
			<form id="form">
				<!--begin row3 -->
				<div id="row3" class="row last">
					When input 
					<select id="sensor3" class="sensor" name="sensor3">
						<option value="0">-</option>
						<option value="1">A</option>
						<option value="2">B</option>
						<option value="3">C</option>
						<option value="4">D</option>
						<option value="5">E</option>
						<option value="6">F</option>
					</select>
					is
					<select id="sensor_state3" class="sensor_state" name="sensor_state3">
						<option value="1">on</option>
						<option value="0">off</option>
					</select>
					&nbsp;&nbsp;:&nbsp;&nbsp;
					Wait
					
					<div class="wait_updown">
						<a href="#" class="up">+</a>
						<a href="#" class="down">-</a>
					</div>
					<input type="text" id="wait_time3" class="wait_time" name="wait_time3" maxlength="3" value="0" />
					second(s) then turn output
					<select id="output3" class="output" name="output3">
						<option value="0">-</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
					</select>
					<select id=="output_state3" class="output_state" name="output_state3">
						<option value="1">on</option>
						<option value="0">off</option>
					</select>
					<select id="output_duration3" class="output_duration" name="output_duration3">
						<option value="000">constantly</option>
						<option value="001">for 1 second</option>
						<option value="005">for 5 seconds</option>
						<option value="010">for 10 seconds</option>
						<option value="015">for 15 seconds</option>
						<option value="025">for 25 seconds</option>
						<option value="030">for 30 seconds</option>
						<option value="045">for 45 seconds</option>
						<option value="060">for 60 seconds</option>
					</select>
					<span class="row_status"></span>
				</div>
				<!--end row3 -->
				<!--begin row3 -->
				<div id="row3" class="row last">
					When input 
					<select id="sensor3" class="sensor" name="sensor3">
						<option value="0">-</option>
						<option value="1">A</option>
						<option value="2">B</option>
						<option value="3">C</option>
						<option value="4">D</option>
						<option value="5">E</option>
						<option value="6">F</option>
					</select>
					is
					<select id="sensor_state3" class="sensor_state" name="sensor_state3">
						<option value="1">on</option>
						<option value="0">off</option>
					</select>
					&nbsp;&nbsp;:&nbsp;&nbsp;
					Wait (up/down ^)
					<input type="text" id="wait_time3" class="wait_time" name="wait_time3" maxlength="3" value="0" />
					second(s) then turn output
					<select id="output3" class="output" name="output3">
						<option value="0">-</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
					</select>
					<select id=="output_state3" class="output_state" name="output_state3">
						<option value="1">on</option>
						<option value="0">off</option>
					</select>
					<select id="output_duration3" class="output_duration" name="output_duration3">
						<option value="000">constantly</option>
						<option value="001">for 1 second</option>
						<option value="005">for 5 seconds</option>
						<option value="010">for 10 seconds</option>
						<option value="015">for 15 seconds</option>
						<option value="025">for 25 seconds</option>
						<option value="030">for 30 seconds</option>
						<option value="045">for 45 seconds</option>
						<option value="060">for 60 seconds</option>
					</select>
					<span class="row_status"></span>
				</div>
				<!--end row3 -->
				<!--begin row3 -->
				<div id="row3" class="row last">
					When input 
					<select id="sensor3" class="sensor" name="sensor3">
						<option value="0">-</option>
						<option value="1">A</option>
						<option value="2">B</option>
						<option value="3">C</option>
						<option value="4">D</option>
						<option value="5">E</option>
						<option value="6">F</option>
					</select>
					is
					<select id="sensor_state3" class="sensor_state" name="sensor_state3">
						<option value="1">on</option>
						<option value="0">off</option>
					</select>
					&nbsp;&nbsp;:&nbsp;&nbsp;
					Wait (up/down ^)
					<input type="text" id="wait_time3" class="wait_time" name="wait_time3" maxlength="3" value="0" />
					second(s) then turn output
					<select id="output3" class="output" name="output3">
						<option value="0">-</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
					</select>
					<select id=="output_state3" class="output_state" name="output_state3">
						<option value="1">on</option>
						<option value="0">off</option>
					</select>
					<select id="output_duration3" class="output_duration" name="output_duration3">
						<option value="000">constantly</option>
						<option value="001">for 1 second</option>
						<option value="005">for 5 seconds</option>
						<option value="010">for 10 seconds</option>
						<option value="015">for 15 seconds</option>
						<option value="025">for 25 seconds</option>
						<option value="030">for 30 seconds</option>
						<option value="045">for 45 seconds</option>
						<option value="060">for 60 seconds</option>
					</select>
					<span class="row_status"></span>
				</div>
				<!--end row3 -->
				<!--begin row3 -->
				<div id="row3" class="row last">
					When input 
					<select id="sensor3" class="sensor" name="sensor3">
						<option value="0">-</option>
						<option value="1">A</option>
						<option value="2">B</option>
						<option value="3">C</option>
						<option value="4">D</option>
						<option value="5">E</option>
						<option value="6">F</option>
					</select>
					is
					<select id="sensor_state3" class="sensor_state" name="sensor_state3">
						<option value="1">on</option>
						<option value="0">off</option>
					</select>
					&nbsp;&nbsp;:&nbsp;&nbsp;
					Wait (up/down ^)
					<input type="text" id="wait_time3" class="wait_time" name="wait_time3" maxlength="3" value="0" />
					second(s) then turn output
					<select id="output3" class="output" name="output3">
						<option value="0">-</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
					</select>
					<select id=="output_state3" class="output_state" name="output_state3">
						<option value="1">on</option>
						<option value="0">off</option>
					</select>
					<select id="output_duration3" class="output_duration" name="output_duration3">
						<option value="000">constantly</option>
						<option value="001">for 1 second</option>
						<option value="005">for 5 seconds</option>
						<option value="010">for 10 seconds</option>
						<option value="015">for 15 seconds</option>
						<option value="025">for 25 seconds</option>
						<option value="030">for 30 seconds</option>
						<option value="045">for 45 seconds</option>
						<option value="060">for 60 seconds</option>
					</select>
					<span class="row_status"></span>
				</div>
				<!--end row3 -->
				<!--begin row3 -->
				<div id="row3" class="row last">
					When input 
					<select id="sensor3" class="sensor" name="sensor3">
						<option value="0">-</option>
						<option value="1">A</option>
						<option value="2">B</option>
						<option value="3">C</option>
						<option value="4">D</option>
						<option value="5">E</option>
						<option value="6">F</option>
					</select>
					is
					<select id="sensor_state3" class="sensor_state" name="sensor_state3">
						<option value="1">on</option>
						<option value="0">off</option>
					</select>
					&nbsp;&nbsp;:&nbsp;&nbsp;
					Wait (up/down ^)
					<input type="text" id="wait_time3" class="wait_time" name="wait_time3" maxlength="3" value="0" />
					second(s) then turn output
					<select id="output3" class="output" name="output3">
						<option value="0">-</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
					</select>
					<select id=="output_state3" class="output_state" name="output_state3">
						<option value="1">on</option>
						<option value="0">off</option>
					</select>
					<select id="output_duration3" class="output_duration" name="output_duration3">
						<option value="000">constantly</option>
						<option value="001">for 1 second</option>
						<option value="005">for 5 seconds</option>
						<option value="010">for 10 seconds</option>
						<option value="015">for 15 seconds</option>
						<option value="025">for 25 seconds</option>
						<option value="030">for 30 seconds</option>
						<option value="045">for 45 seconds</option>
						<option value="060">for 60 seconds</option>
					</select>
					<span class="row_status"></span>
				</div>
				<!--end row3 -->
				<!--begin row3 -->
				<div id="row3" class="row last">
					When input 
					<select id="sensor3" class="sensor" name="sensor3">
						<option value="0">-</option>
						<option value="1">A</option>
						<option value="2">B</option>
						<option value="3">C</option>
						<option value="4">D</option>
						<option value="5">E</option>
						<option value="6">F</option>
					</select>
					is
					<select id="sensor_state3" class="sensor_state" name="sensor_state3">
						<option value="1">on</option>
						<option value="0">off</option>
					</select>
					&nbsp;&nbsp;:&nbsp;&nbsp;
					Wait (up/down ^)
					<input type="text" id="wait_time3" class="wait_time" name="wait_time3" maxlength="3" value="0" />
					second(s) then turn output
					<select id="output3" class="output" name="output3">
						<option value="0">-</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
					</select>
					<select id=="output_state3" class="output_state" name="output_state3">
						<option value="1">on</option>
						<option value="0">off</option>
					</select>
					<select id="output_duration3" class="output_duration" name="output_duration3">
						<option value="000">constantly</option>
						<option value="001">for 1 second</option>
						<option value="005">for 5 seconds</option>
						<option value="010">for 10 seconds</option>
						<option value="015">for 15 seconds</option>
						<option value="025">for 25 seconds</option>
						<option value="030">for 30 seconds</option>
						<option value="045">for 45 seconds</option>
						<option value="060">for 60 seconds</option>
					</select>
					<span class="row_status"></span>
				</div>
				<!--end row3 -->

				<button id="save" name="save" type="button">Save Program</button>

			</form>
  
		</div>
	</div>
	<script src="scripts.js"></script>
</body>
</html>